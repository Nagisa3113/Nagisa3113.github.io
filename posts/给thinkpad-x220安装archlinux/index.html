<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>给ThinkPad-X220安装ArchLinux | Nostalgia</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="最近在某海鲜市场淘了台ThinkPad X220，记录一下ArchLinux的配置过程">
<meta name="generator" content="Hugo 0.110.0">


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'your-google-analytics-id', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">←</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">给ThinkPad-X220安装ArchLinux</h1>

    <div class="tip">
        <time datetime="2020-02-10 00:00:00 &#43;0000 UTC">Feb 10, 2020</time>
        <span class="split">
          ·
        </span>
        <span>
          1234 words
        </span>
        <span class="split">
          ·
        </span>
        <span>
          3 minute read
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#安装archlinux">安装Archlinux</a></li>
    <li><a href="#新建用户">新建用户</a></li>
    <li><a href="#桌面环境">桌面环境</a></li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <p>最近在某海鲜市场淘了台ThinkPad X220，记录一下ArchLinux的配置过程</p>
<p>ThinkPad向来有着笔记本界最好的键盘手感，其余配置如下</p>
<ul>
<li>CPU 2520M 双核</li>
<li>Memory: 4+4GB</li>
<li>Storage: 500G Samsung 860evo msata</li>
<li>Display: 1366*768</li>
</ul>
<p>为什么使用 Linux</p>
<ul>
<li>避免Windows在老设备上的高资源消耗，比如偷偷更新</li>
</ul>
<p>为什么使用Arch</p>
<ul>
<li>精简、高度自定义，完善的包管理pacman</li>
</ul>
<p>为什么使用i3wm窗口管理器</p>
<ul>
<li>分屏很方便，完全键盘操作，很geek</li>
</ul>
<h2 id="安装archlinux">安装Archlinux <a href="#%e5%ae%89%e8%a3%85archlinux" class="anchor">🔗</a></h2><p>参考<a href="https://wiki.archlinux.org/title/Installation_guide_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29" target="_blank" rel="noopener">官方中文安装教程</a></p>
<p>前往<a href="https://archlinux.org/download" target="_blank" rel="noopener">官网</a>下载镜像，使用rufus将镜像写入U盘，并从U盘启动</p>
<p>以下为UEFI引导，单sata硬盘，全盘安装方法，</p>
<p>ArchLinux使用滚动更新，也就是说时刻都保持最新版，所以需要联网安装</p>
<p>这里使用有线网安装</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>dhcpcd
</span></span></code></pre></div><p>更新系统时间</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>timedatectl set-ntp true
</span></span></code></pre></div><p>分区与格式化</p>
<ol>
<li>查看目前分区</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>fdisk -l
</span></span></code></pre></div><ol start="2">
<li>创建引导分区，sda表示第一块sata硬盘，也有可能是其他</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>fdisk /dev/sda
</span></span></code></pre></div><ol>
<li>如果是新硬盘，输入g创建全新的gpt分区表</li>
<li>输入n创建一个新的分区，选择起始扇区和分区大小，前者默认，后者输入+512M</li>
<li>输入t并选择新创建的分区序号来更改分区的类型，输入l查看所有支持的类型，输入ef更改分区的类型为EFI</li>
<li>输入w写入磁盘，输入p来确认分区表</li>
<li>格式化刚刚创建的引导分区</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mkfs.fat -F32 /dev/sda1
</span></span></code></pre></div><p>创建根分区</p>
<ol>
<li>输入n创建一个新的分区，选择起始扇区和分区大小，全部默认表示使用全盘安装。</li>
<li>输入w写入磁盘</li>
<li>格式化根分区</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mkfs.ext4 /dev/sda2
</span></span></code></pre></div><p>挂载分区</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mount /dev/sda2 /mnt
</span></span><span style="display:flex;"><span>mkdir /mnt/boot
</span></span><span style="display:flex;"><span>mount /dev/sda1/ mnt/boot
</span></span></code></pre></div><p>选择镜像</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim /etc/pacman.d/mirrorlist
</span></span></code></pre></div><p>在文件首加入</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Server = http://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
</span></span></code></pre></div><p>安装基本软件</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacstrap /mnt base base-devel linux linux-firmware dhcpcd
</span></span></code></pre></div><p>生成自动挂载分区的fstab文件</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>genfstab -L /mnt &gt;&gt; /mnt/etc/fstab
</span></span></code></pre></div><p>将权限切换到新安装的系统</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>arch-chroot /mnt
</span></span></code></pre></div><p>设置时区</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span><span style="display:flex;"><span>hwclock --systohc
</span></span></code></pre></div><p>安装其他软件</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacman -S vim dialog wpa_supplicant ntfs-3g networkmanager netctl
</span></span></code></pre></div><p>设置语言，找到zh-CN和en_US行，取消注释</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim /etc/locale.gen
</span></span></code></pre></div><p>生成</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>locale-gen
</span></span></code></pre></div><p>设置系统语言</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim /etc/locale.conf
</span></span></code></pre></div><p>写入</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>LANG=en_US.UTF-8
</span></span></code></pre></div><p>设置主机名，在首行输入主机名，这里是ThinkPad-X220</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim /etc/hostname
</span></span></code></pre></div><p>同样</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>vim /etc/hosts
</span></span></code></pre></div><p>写入</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>127.0.0.1		  localhost
</span></span><span style="display:flex;"><span>::1				localhost
</span></span><span style="display:flex;"><span>127.0.1.1		ThinkPad-X220.localdomain	ThinkPad-X220
</span></span></code></pre></div><p>设置Root密码</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>passwd
</span></span></code></pre></div><p>安装微码，此处为因特尔处理器</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacman -S intel-ucode
</span></span></code></pre></div><p>安装Bootloader</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacman -S os-prober ntfs-3g
</span></span><span style="display:flex;"><span>pacman -S grub efibootmgr
</span></span><span style="display:flex;"><span>grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub
</span></span><span style="display:flex;"><span>grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></div><p>重新部署linux内核</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacman -S linux
</span></span></code></pre></div><p>退出</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>exit
</span></span></code></pre></div><p>取消挂载</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>umount /mnt/boot
</span></span><span style="display:flex;"><span>umount /mnt
</span></span></code></pre></div><p>重启</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>reboot
</span></span></code></pre></div><p>然后就进入了Archlinux的命令行界面，用户名是root，密码是刚才设置的密码，到此安装结束</p>
<h2 id="新建用户">新建用户 <a href="#%e6%96%b0%e5%bb%ba%e7%94%a8%e6%88%b7" class="anchor">🔗</a></h2><p>设置用户名和组</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>useradd -m -G wheel nagisa
</span></span></code></pre></div><p>设置用户密码</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>passwd nagsia
</span></span></code></pre></div><p>切换到root用户</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>su
</span></span></code></pre></div><p>安装sudo</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pacman -S sudo
</span></span></code></pre></div><p>将vi链接到vim</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ln -s /usr/bin/vim /usr/bin/vi
</span></span><span style="display:flex;"><span>visudo
</span></span></code></pre></div><p>取消<code>%wheel ALL=(ALL)ALL</code>前的#注释</p>
<p>退出root</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>exit
</span></span></code></pre></div><h2 id="桌面环境">桌面环境 <a href="#%e6%a1%8c%e9%9d%a2%e7%8e%af%e5%a2%83" class="anchor">🔗</a></h2><p>联网</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>dhcpcd//有线网
</span></span><span style="display:flex;"><span>wifi-menu//无线网
</span></span></code></pre></div><p>安装显卡驱动，参考<a href="https://wiki.archlinux.org/index.php/Xorg#Driver_installation" target="_blank" rel="noopener">这里</a>，此处为intel集成显卡</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo pacman -S xf86-video-intel
</span></span></code></pre></div><p>安装Xorg</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo pacman -S xorg
</span></span></code></pre></div><p>安装桌面管理器，此处为lightdm</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo pacman -S lightdm
</span></span></code></pre></div><p>设置开机自动启动</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo systemctl enable lightdm
</span></span></code></pre></div><p>安装桌面环境, 比较著名的有Gnome、KDE(Plasma)、Xfce，此处使用i3wm</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sudo pacman -S i3wm
</span></span></code></pre></div><p>如果安装了桌面管理器，重启的时候就有图形界面可以选择了</p>
<p>第一次进入i3，非常简陋，但是不要慌</p>
<p>安装各种软件</p>
<ul>
<li>terminal	st</li>
<li>输入法	fcitx fcitx-config-tool</li>
<li>字体		ttf-dejavu</li>
<li>浏览器		firefox</li>
<li>文件管理器	pcmanfm ranger</li>
<li>命令行工具	zsh neofetch htop</li>
</ul>
<p>其余的配置文件保存在我的github中，如i3快捷键，字体缩放比例，个性化bar等</p>
    </div>

    
    
    

</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="your-github-link" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>


</div>

    

    <div class="copyright">
    
       © Copyright 
       2023 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       nagisa
    
    </div>

    
</footer>



  </body>
</html>
